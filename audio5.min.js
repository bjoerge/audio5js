/*! audio5 2013-04-03 */
(function(t,i,e){"use strict";"undefined"!=typeof module&&module.exports?module.exports=e(i,t):"function"==typeof define&&define.amd?define(function(){return e(i,t)}):t[i]=e(i,t)})(window,"Audio5js",function(t,i){"use strict";function e(t){this.message=t}function n(t){var i,e={};for(i in t)e[i]="object"==typeof t[i]?n(t[i]):t[i];return e}var s=function(t){function i(t){for(l=1;t=n.shift();)t()}var e,n=[],s=!1,o=document,a=o.documentElement,r=a.doScroll,h="DOMContentLoaded",d="addEventListener",u="onreadystatechange",c="readyState",l=/^loade|c/.test(o[c]);return o[d]&&o[d](h,e=function(){o.removeEventListener(h,e,s),i()},s),r&&o.attachEvent(u,e=function(){/^c/.test(o[c])&&(o.detachEvent(u,e),i())}),t=r?function(i){self!=top?l?i():n.push(i):function(){try{a.doScroll("left")}catch(e){return setTimeout(function(){t(i)},50)}i()}()}:function(t){l?t():n.push(t)}}(),o=i.ActiveXObject;e.prototype=Error();var a=function(t,i){var e,s=n(i);for(e in s)s.hasOwnProperty(e)&&(t[e]=s[e]);return t},r=function(t,i){return a(t.prototype,i)},h={on:function(t,i,e){void 0===this.channels&&(this.channels={}),this.channels[t]=this.channels[t]||[],this.channels[t].push({fn:i,ctx:e})},off:function(t,i){if(void 0!==this.channels[t]){var e,n;for(e=0,n=this.channels[t].length;n>e;e++){var s=this.channels[t][e].fn;if(s===i){this.channels[t].splice(e,1);break}}}},trigger:function(t){if(this.channels&&this.channels.hasOwnProperty(t)){var i,e,n=Array.prototype.slice.call(arguments,1);for(i=0,e=this.channels[t].length;e>i;i++){var s=this.channels[t][i];"function"==typeof s.fn&&s.fn.apply(s.ctx,n)}}}},d={flash_embed_code:function(){var i,e='<param name="movie" value="$2?playerInstance=window.'+t+"_flash.instances['$1']&datetime=$3\"/>"+'<param name="wmode" value="transparent"/>'+'<param name="allowscriptaccess" value="always" />'+"</object>";return i=o?'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1" id="$1">':'<object type="application/x-shockwave-flash" data="$2?playerInstance=window.'+t+'_flash.instances[\'$1\']&datetime=$3" width="1" height="1" id="$1" >',i+e}(),can_play:function(t){var i,e=document.createElement("audio");switch(t){case"mp3":i='audio/mpeg; codecs="mp3"';break;case"vorbis":i='audio/ogg; codecs="vorbis"';break;case"opus":i='audio/ogg; codecs="opus"';break;case"webm":i='audio/webm; codecs="vorbis"';break;case"mp4":i='audio/mp4; codecs="mp4a.40.5"';break;case"wav":i='audio/wav; codecs="1"'}if(void 0===i)throw Error("Unspecified Audio Mime Type");return!!e.canPlayType&&""!==e.canPlayType(i)},has_flash:function(){var t=!1;if(navigator.plugins&&navigator.plugins.length&&navigator.plugins["Shockwave Flash"])t=!0;else if(navigator.mimeTypes&&navigator.mimeTypes.length){var i=navigator.mimeTypes["application/x-shockwave-flash"];t=i&&i.enabledPlugin}else try{var e=new o("ShockwaveFlash.ShockwaveFlash");t="object"==typeof e}catch(n){}return t}(),embedFlash:function(e,n){var o=document.createElement("div");if(o.style.position="absolute",o.style.width="1px",o.style.height="1px",o.style.top="1px",s(function(){document.body.appendChild(o)}),"object"==typeof i.swfobject){var a={playerInstance:"window."+t+'_flash.instances["'+n+'"]'},r={allowscriptaccess:"always",wmode:"transparent"};o.innerHTML='<div id="'+n+'"></div>',swfobject.embedSWF(e+"?ts="+((new Date).getTime()+Math.random()),n,"1","1","9.0.0",null,a,r)}else{var h=this.flash_embed_code.replace(/\$1/g,n);h=h.replace(/\$2/g,e),h=h.replace(/\$3/g,(new Date).getTime()+Math.random()),o.innerHTML=h}return document.getElementById(n)},formatTime:function(t){var i,e=parseInt(t/3600,10)%24,n=parseInt(t/60,10)%60,s=parseInt(t%60,10),o=(10>n?"0"+n:n)+":"+(10>s?"0"+s:s);return i=e>0?(10>e?"0"+e:e)+":"+o:o}};d.use_flash=d.can_play("mp3");var u,c,l,p={playing:!1,vol:1,duration:0,position:0,load_percent:0,seekable:null,ready:null},f=i[t+"_flash"]=i[t+"_flash"]||{instances:{},count:0};c=function(){if(d.use_flash&&!d.has_flash)throw Error("Flash Plugin Missing")},c.prototype={init:function(i){f.count+=1,this.id=t+f.count,f.instances[this.id]=this,this.embed(i)},embed:function(t){d.embedFlash(t,this.id)},eiReady:function(){this.audio=document.getElementById(this.id),this.trigger("ready")},eiTimeUpdate:function(t,i,e){this.position=t,this.duration=i,this.seekable=e,this.trigger("timeupdate",t,this.seekable?i:null)},eiProgress:function(t){this.load_percent=t,this.trigger("progress",t)},eiLoadError:function(t){this.trigger("error",t)},eiPlay:function(){this.playing=!0,this.trigger("play")},eiPause:function(){this.playing=!1,this.trigger("pause")},eiEnded:function(){this.playing=!1,this.trigger("ended")},eiCanPlay:function(){this.trigger("canplay")},reset:function(){this.seekable=!1,this.duration=0,this.position=0,this.load_percent=0},load:function(t){this.reset(),this.audio.load(t)},play:function(){this.audio.pplay()},pause:function(){this.audio.ppause()},volume:function(t){return void 0===t||isNaN(parseInt(t,10))?this.vol:(this.audio.setVolume(t),this.vol=t,void 0)},seek:function(t){try{this.audio.seekTo(t),this.position=t}catch(i){}}},r(c,h),r(c,p),l=function(){},l.prototype={init:function(){this.trigger("ready")},createAudio:function(){this.audio=new Audio,this.audio.autoplay=!1,this.audio.preload="auto",this.audio.autobuffer=!0,this.bindEvents()},destroyAudio:function(){this.audio&&(this.unbindEvents(),delete this.audio)},bindEvents:function(){this.audio.addEventListener("timeupdate",this.onTimeUpdate.bind(this)),this.audio.addEventListener("play",this.onPlay.bind(this)),this.audio.addEventListener("pause",this.onPause.bind(this)),this.audio.addEventListener("ended",this.onEnded.bind(this)),this.audio.addEventListener("canplay",this.onLoad.bind(this)),this.audio.addEventListener("error",this.onError.bind(this))},unbindEvents:function(){this.audio.removeEventListener("timeupdate",this.onTimeUpdate.bind(this)),this.audio.removeEventListener("play",this.onPlay.bind(this)),this.audio.removeEventListener("pause",this.onPause.bind(this)),this.audio.removeEventListener("ended",this.onEnded.bind(this)),this.audio.removeEventListener("canplay",this.onLoad.bind(this)),this.audio.removeEventListener("error",this.onError.bind(this))},onPlay:function(){this.playing=!0,this.trigger("play")},onPause:function(){this.playing=!1,this.trigger("pause")},onEnded:function(){this.playing=!1,this.trigger("ended")},onTimeUpdate:function(){null!==this.audio.buffered&&this.audio.buffered.length&&this.playing&&(this.position=this.audio.currentTime,this.duration=1/0===this.audio.duration?null:this.audio.duration,this.trigger("timeupdate",this.position,this.duration))},onLoad:function(){this.seekable=this.audio.seekable&&this.audio.seekable.length>0,this.seekable&&(this.timer=setInterval(this.onProgress.bind(this),250)),this.trigger("canplay")},onProgress:function(){null!==this.audio.buffered&&this.audio.buffered.length&&(this.load_percent=parseInt(100*(this.audio.buffered.end(this.audio.buffered.length-1)/this.audio.duration),10),this.trigger("progress",this.load_percent),this.load_percent>=100&&this.clearLoadProgress())},onError:function(t){this.trigger("error",t)},clearLoadProgress:function(){void 0!==this.timer&&(clearInterval(this.timer),delete this.timer)},reset:function(){this.clearLoadProgress(),this.seekable=!1,this.duration=0,this.position=0,this.load_percent=0},load:function(t){this.reset(),this.destroyAudio(),this.createAudio(),this.audio.setAttribute("src",t),this.audio.load()},play:function(){this.audio.play()},pause:function(){this.audio.pause()},volume:function(t){if(void 0===t||isNaN(parseInt(t,10)))return this.vol;var i=0>t?0:Math.min(1,t);this.audio.volume=i,this.vol=i},seek:function(t){var i=this.playing;this.position=t,this.audio.currentTime=t,i?this.play():null!==this.audio.buffered&&this.audio.buffered.length&&this.trigger("timeupdate",this.position,this.duration)}},r(l,h),r(l,p);var g={swf_path:"/swf/audiojs.swf",throw_errors:!0,format_time:!0,codecs:["mp3"]};return u=function(t){t=t||{};var i;for(i in g)g.hasOwnProperty(i)&&!t.hasOwnProperty(i)&&(t[i]=g[i]);this.init(t)},u.can_play=function(t){return d.can_play(t)},u.prototype={init:function(t){this.ready=!1,this.settings=t,this.audio=this.getPlayer(),this.bindAudioEvents(),this.settings.use_flash?this.audio.init(t.swf_path):this.audio.init()},getPlayer:function(){var t,i,e;for(t=0,i=this.settings.codecs.length;i>t;t++){var n=this.settings.codecs[t];if(u.can_play(n)){e=new l,this.settings.use_flash=!1,this.settings.player={engine:"html",codec:n};break}}return void 0===e&&(this.settings.use_flash=!u.can_play("mp3"),e=this.settings.use_flash?new c:new l,this.settings.player={engine:this.settings.use_flash?"flash":"html",codec:"mp3"}),e},bindAudioEvents:function(){this.audio.on("ready",this.onReady,this),this.audio.on("play",this.onPlay,this),this.audio.on("pause",this.onPause,this),this.audio.on("ended",this.onEnded,this),this.audio.on("canplay",this.onCanPlay,this),this.audio.on("timeupdate",this.onTimeUpdate,this),this.audio.on("progress",this.onProgress,this),this.audio.on("error",this.onError,this)},load:function(t){var i=function(t){this.audio.load(t),this.trigger("load")}.bind(this,t);this.ready?i():this.on("ready",i)},play:function(){this.playing||this.audio.play()},pause:function(){this.playing&&this.audio.pause()},playPause:function(){this[this.playing?"pause":"play"]()},volume:function(t){return void 0===t||isNaN(parseInt(t,10))?this.vol:(this.audio.volume(t),this.vol=t,void 0)},seek:function(t){this.audio.seek(t),this.position=t},onReady:function(){this.ready=!0,"function"==typeof this.settings.ready&&this.settings.ready.call(this,this.settings.player),this.trigger("ready")},onPlay:function(){this.playing=!0,this.trigger("play")},onPause:function(){this.playing=!1,this.trigger("pause")},onEnded:function(){this.playing=!1,this.trigger("ended")},onError:function(){var t=new e("Audio Error. Failed to Load Audio");if(this.settings.throw_errors)throw t;this.trigger("error",t)},onCanPlay:function(){this.trigger("canplay")},onTimeUpdate:function(t,i){this.position=this.settings.format_time?d.formatTime(t):t,this.duration!==i&&(this.duration=this.settings.format_time&&null!==i?d.formatTime(i):i),this.trigger("timeupdate",this.position,this.duration)},onProgress:function(t){this.load_percent=t,this.trigger("progress",t)}},r(u,h),r(u,p),u});